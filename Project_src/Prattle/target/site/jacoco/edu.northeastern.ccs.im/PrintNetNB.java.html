<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrintNetNB.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Prattle</a> &gt; <a href="index.source.html" class="el_package">edu.northeastern.ccs.im</a> &gt; <span class="el_source">PrintNetNB.java</span></div><h1>PrintNetNB.java</h1><pre class="source lang-java linenums">package edu.northeastern.ccs.im;

import edu.northeastern.ccs.im.server.Prattle;

import java.io.IOException;
import java.nio.ByteBuffer;
import java.nio.channels.SocketChannel;
import java.util.logging.Level;
import java.util.logging.Logger;


/**
 * This class is similar to the java.io.PrintWriter class, but this class's
 * methods work with our non-blocking Socket classes. This class could easily be
 * made to wait for network output (e.g., be made &amp;quot;non-blocking&amp;quot; in
 * technical parlance), but I have not worried about it yet.
 * &lt;p&gt;
 * This work is licensed under the Creative Commons Attribution-ShareAlike 4.0
 * International License. To view a copy of this license, visit
 * http://creativecommons.org/licenses/by-sa/4.0/. It is based on work
 * originally written by Matthew Hertz and has been adapted for use in a class
 * assignment at Northeastern University.
 *
 * @version 1.3
 */
<span class="pc bpc" id="L26" title="1 of 2 branches missed.">public class PrintNetNB {</span>
    /**
     * Channel over which we will write out any messages.
     */
    private final SocketChannel channel;

    /**
     * Number of times to try sending a message before we give up in frustration.
     */
    private static final int MAXIMUM_TRIES_SENDING = 100;

<span class="fc" id="L37">    private static final Logger LOGGER = Logger.getLogger(Prattle.class.getName());</span>

    /**
     * Creates a new instance of this class. Since, by definition, this class sends
     * output over the network, we need to supply the non-blocking Socket instance
     * to which we will write.
     *
     * @param sockChan Non-blocking SocketChannel instance to which we will send all
     *                 communication.
     */
<span class="fc" id="L47">    public PrintNetNB(SocketChannel sockChan) {</span>
        // Remember the channel that we will be using.
<span class="fc" id="L49">        channel = sockChan;</span>
<span class="fc" id="L50">    }</span>

    /**
     * Creates a new instance of this class. Since, by definition, this class sends
     * output over the network, we need to supply the non-blocking Socket instance
     * to which we will write.
     *
     * @param connection Non-blocking Socket instance to which we will send all
     *                   communication.
     */
<span class="fc" id="L60">    public PrintNetNB(SocketNB connection) {</span>
        // Remember the channel that we will be using.
<span class="fc" id="L62">        channel = connection.getSocket();</span>
<span class="fc" id="L63">    }</span>

    /**
     * Send a Message over the network. This method performs its actions by printing
     * the given Message over the SocketNB instance with which the PrintNetNB was
     * instantiated. This returns whether our attempt to send the message was
     * successful.
     *
     * @param msg Message to be sent out over the network.
     * @return True if we successfully send this message; false otherwise.
     */
    public boolean print(Message msg) {
<span class="fc" id="L75">        String str = msg.toString();</span>
<span class="fc" id="L76">        ByteBuffer wrapper = ByteBuffer.wrap(str.getBytes());</span>
<span class="fc" id="L77">        int bytesWritten = 0;</span>
<span class="fc" id="L78">        int attemptsRemaining = MAXIMUM_TRIES_SENDING;</span>
<span class="pc bpc" id="L79" title="1 of 4 branches missed.">        while (wrapper.hasRemaining() &amp;&amp; (attemptsRemaining &gt; 0)) {</span>
            try {
<span class="fc" id="L81">                attemptsRemaining--;</span>
<span class="fc" id="L82">                bytesWritten += channel.write(wrapper);</span>
<span class="fc" id="L83">            } catch (IOException e) {</span>
                // Show that this was unsuccessful
<span class="fc" id="L85">                return false;</span>
<span class="fc" id="L86">            }</span>
        }
        // Check to see if we were successful in our attempt to write the message
<span class="pc bpc" id="L89" title="1 of 2 branches missed.">        if (wrapper.hasRemaining()) {</span>
<span class="nc" id="L90">            LOGGER.log(Level.WARNING, &quot;WARNING: Not all bytes were sent -- dropping this user. &quot;);</span>
<span class="nc bnc" id="L91" title="All 4 branches missed.">            assert bytesWritten != 0;</span>
<span class="nc" id="L92">            return false;</span>
        }
<span class="fc" id="L94">        return true;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>